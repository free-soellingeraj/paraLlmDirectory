# Credential Orchestrator Configuration
# Copy this file to: $PARA_LLM_ROOT/plugins/credential-proxy/credentials.yaml
# Or place per-project overrides at: <project-root>/.para-llm/credentials.yaml

version: 1

settings:
  # How long to cache resolved secrets in proxy memory (seconds)
  cache_ttl: 300
  # Re-fetch secret on 401 response from upstream
  retry_on_401: true
  # Default provider if not specified per-rule
  default_provider: gcp-secrets

# Provider configuration
providers:
  gcp-secrets:
    project: my-gcp-project    # default GCP project for secrets
  # 1password:
  #   vault: Development
  # env-var: {}
  # file:
  #   dir: /path/to/secrets

# Tier 1: OAuth / CLI auth
# These tools are authenticated via their native OAuth flows.
# The agent just uses the CLI normally - no secrets needed.
oauth:
  gcloud:
    enabled: true
    strategy: service-account-impersonation
    service_account: my-sa@project.iam.gserviceaccount.com
  gh:
    enabled: true
    strategy: oauth-device-flow
  # az:
  #   enabled: false

# Tier 2: Credential helpers
# Tools with native credential helper support get custom helpers
# that fetch secrets from the provider backend.
credential_helpers:
  git:
    enabled: true
    provider: gcp-secrets
    secret_ref: github-pat     # secret name in provider
  docker:
    enabled: true
    registries:
      ghcr.io:
        provider: gcp-secrets
        secret_ref: ghcr-token
      # us-docker.pkg.dev:
      #   provider: gcp-secrets
      #   secret_ref: gar-token
  # npm:
  #   enabled: false
  #   registry: https://npm.internal.example.com
  #   secret_ref: npm-token

# Tier 3: HTTP proxy rules
# The MITM proxy intercepts requests and injects auth headers.
# Secrets exist only in proxy process memory.
http_proxy:
  enabled: true
  port_base: 18080           # starting port; each env gets port_base + N
  rules:
    # Example: inject auth header for an internal API
    # - name: "Internal API"
    #   match:
    #     host: "api.internal.example.com"
    #   inject:
    #     headers:
    #       Authorization: "Bearer {secret:api-internal-token}"

    # Example: inject API key for a third-party service
    # - name: "Third-party API"
    #   match:
    #     host: "api.thirdparty.com"
    #     path_prefix: "/v2/"
    #   inject:
    #     headers:
    #       X-API-Key: "{secret:thirdparty-api-key}"

  # Hosts that should bypass the proxy entirely
  passthrough:
    - "api.anthropic.com"
    - "*.anthropic.com"

# Tier 4: Config file population (fallback for tools without better options)
# config_files:
#   kubectl:
#     enabled: false
#     template: "~/.kube/config.template"
#     output: "~/.kube/config"
#     secrets:
#       CLUSTER_TOKEN: "k8s-cluster-token"
